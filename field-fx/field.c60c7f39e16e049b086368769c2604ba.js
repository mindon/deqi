Array.from(document.querySelectorAll("canvas.field-fx")).forEach(e=>B(e));globalThis.fieldFx=B;globalThis.dispatchEvent(new CustomEvent("field-fx-ready"));function B(e,i){let a={g:1,k:1,z:2,tension:.25,stroke:1,zoom:1};i&&(i.g&&(a.g=i.g),i.k&&(a.k=i.k),i.z&&(a.z=i.z),i.tension&&(a.tension=i.tension));let x=12,s="99",y=()=>{let c=e.dataset,{origin:d,src:A="/img/mindon.png",rgb:E="",unit:w="8",stroke:g="1",zoom:u="1",area:C=""}=c;return a.stroke=parseFloat(g)||1,a.zoom=parseFloat(u)||1,{showOrigin:d!==void 0,src:A,rgb:E,beta:parseInt(w,10)||8,area:C&&/^\d+(,\d+){3}$/.test(C)?C.split(",").map(R=>parseInt(R,10)):void 0}},{showOrigin:f,src:h,rgb:t,beta:n,area:o}=y(),r=e.getContext("2d");r?.clearRect(0,0,e.width,e.height);let b,[l,p,k]=[0,0,0];if(!r)return;r.imageSmoothingEnabled=!0;let M,D=document.createElement("canvas"),m=new Image,T=()=>{if(!r)return;r.clearRect(0,0,e.width,e.height);let[c,d]=[m.naturalWidth,m.naturalHeight];if(!o&&(c>960||d>960)){let z=Math.max(c/562,d/562);o=[0,0,c/z,d/z]}o&&([c,d]=o.slice(2)),[l,p,k]=[c/2,d/2,Math.sqrt((c/2)**2+(d/2)**2)],M={ctx:r,cx:l,cy:p,feature:a},e.width=c*(a.zoom||1),e.height=d*(a.zoom||1);let[A,E]=[Math.round(c/n),Math.round(d/n)];D.width=A,D.height=E;let w=D.getContext("2d"),[g,u]=[0,0];o&&([g,u]=o.slice(0,2)),w?.drawImage(m,g,u,o?c:m.width,o?d:m.height,0,0,A,E),f&&(m.width=c,m.height=d,e.parentElement?.appendChild(m));let C=w?.getImageData(0,0,A,E).data,R=[],L=[],O=[],$=[],W=[],j=[];for(let z=0;z<E;z++){let I=[];for(let v=0;v<A;v++)I.push([v,z]);j.push(I)}W=N(j),W.forEach(([z,I])=>{let[v,S,F]=[z*n,I*n,4*(I*A+z)],q=(C?.[F+3]||0)/255,G={x:v,y:S,v:(255-(C?.[F]||0))*q},_={x:v,y:S,v:(255-(C?.[F+1]||0))*q},J={x:v,y:S,v:(255-(C?.[F+2]||0))*q};$.push({x:v,y:S,v:(255-((C?.[F]||0)*.299+(C?.[F+1]||0)*.587+(C?.[F+2]||0)*.114))*q}),R.push(G),L.push(_),O.push(J)}),b={red:R,green:L,blue:O,lightness:$},P()};m.crossOrigin="anonymous",m.addEventListener("load",T),h&&(m.src=h);let P=()=>{if(!r||!M)return;r.clearRect(0,0,e.width,e.height);let{red:c,green:d,blue:A,lightness:E}=b,w=Math.floor(k/n),g=10;if(r.lineWidth=a.stroke||1,/[rR*]/.test(t)){r.beginPath(),r.strokeStyle=`#ff0000${s}`;for(let u=0;u<w;u++)H(M,g+u*n,x,c);r.stroke()}if(/[gG*]/.test(t)){r.beginPath(),r.strokeStyle=`#008800${s}`;for(let u=0;u<w;u++)H(M,g+u*n,x,d);r.stroke()}if(/[bB*]/.test(t)){r.beginPath(),r.strokeStyle=`#0000ff${s}`;for(let u=0;u<w;u++)H(M,g+u*n,x,A);r.stroke()}if(!t||/[#*]/.test(t)){r.beginPath(),r.strokeStyle="#000000";for(let u=0;u<w;u++)H(M,g+u*n,x,E);r.stroke()}};e.reload=()=>{({showOrigin:f,src:h,rgb:t,beta:n,area:o}=y()),h!=m.src?m.src=h:T()},e.draw=P,e.stop=function(){this.playing&&clearTimeout(this.playing),this.dispatchEvent(new CustomEvent("stop"))},e.play=function(c,d=!0){if(c?this.clips=c:c=this.clips,!c||!c.length)throw new Error("clips required");this.playing&&clearTimeout(this.playing);let A=0,E=c.length,w=()=>{if(!c||A>=E&&(A=0,this.dispatchEvent(new CustomEvent("fin")),!d))return;let g=c[A++];g.src&&(h=g.src),g.rgb&&(t=g.rgb),g.area&&g.area.length===4&&(o=g.area),h!=m.src?m.src=h:T(),this.playing=setTimeout(w,(g.dur||.3)*1e3)};w()}}function H(e,i,a,x){let s=a*Math.PI/180,{ctx:y,cx:f,cy:h,feature:t}=e,n=Array.from(Array(Math.ceil(360/a)).keys()).map(l=>{let p={x:f+i*Math.cos(s*l),y:h-i*Math.sin(s*l)},k={x:p.x,y:p.y};return x?.forEach(M=>{let D=K(M,M.v||0,k,t);k.x+=D.x,k.y+=D.y}),k}),{zoom:o=1,tension:r=.25}=t,b=n.map(l=>[o*l.x,o*l.y]);y&&Q(y,b,r)}function K(e,i,a,x){let{x:s,y}=e,f=a.x,h=a.y,{g:t=1,k:n=1,z:o=2}=x,r=Math.sqrt((s-f)**2+(y-h)**2),b=t*i/r**o,l=s===f?y>h?Math.PI/2:-Math.PI/2:Math.atan((y-h)/(s-f));y===h?l=s<f?Math.PI:0:s<f&&(l-=Math.PI);let p={x:b*Math.cos(l)/n,y:b*Math.sin(l)/n};return Math.abs(p.x)>Math.abs(e.x-a.x)&&(p.x=e.x-a.x),Math.abs(p.y)>Math.abs(e.y-a.y)&&(p.y=e.y-a.y),p}function N(e,i=!0){let[a,x]=[e.length,e[0].length],s=e.map(r=>r.map(b=>!1)),y=[],f=[0,1,0,-1],h=[1,0,-1,0],[t,n,o]=[0,0,0];for(let r=0;r<a*x;r++){y.push(e[t][n]),s[t][n]=!0;let[b,l]=[t+f[o],n+h[o]];0<=b&&b<a&&0<=l&&l<x&&!s[b][l]?[t,n]=[b,l]:(o=(o+1)%4,[t,n]=[t+f[o],n+h[o]])}return i?y.reverse():y}function Q(e,i,a,x=!0){a=a||.25;let s=i.length;if(s<2)return;if(e.beginPath(),s===2){e.moveTo(i[0][0],i[0][1]),e.lineTo(i[1][0],i[1][1]),e.stroke();return}let y=(t,n)=>Math.sqrt(t*t+n*n),f=[];i.forEach(function(){f.push({cp:[],cn:[]})});for(let t=0;t<s;t++){let n=i[t],o=i[t-1<0?s+t-1:t-1],r=i[t+1>s-1?(t+1)%s:t+1],b=r[0]-o[0],l=r[1]-o[1],p=y(b,l),k=b/p,M=l/p,D=y(n[0]-o[0],n[1]-o[1]),m=y(n[0]-r[0],n[1]-r[1]),T=n[0]-k*D*a,P=n[1]-M*D*a,c=n[0]+k*m*a,d=n[1]+M*m*a;f[t]={cp:[T,P],cn:[c,d]}}e.moveTo(i[0][0],i[0][1]);let h=x?s+1:s;for(let t=1;t<h;t++){let n=i[t%s],o=f[t%s],r=f[t-1];e.bezierCurveTo(r.cn[0],r.cn[1],o.cp[0],o.cp[1],n[0],n[1])}e.stroke()}export{B as fieldFx};
