Array.from(document.querySelectorAll("canvas.field-fx")).forEach(r=>G(r));globalThis.fieldFx=G;function G(r,a){let o=r.dataset,A=o.origin!==void 0,n={g:1,k:1,z:2,tension:.25,stroke:parseFloat(o.stroke||"1")||1,zoom:parseFloat(o.zoom||"1")||1};a&&(a.g&&(n.g=a.g),a.k&&(n.k=a.k),a.z&&(n.z=a.z),a.tension&&(n.tension=a.tension));let h=12,s=parseInt(o.unit||"8",10)||8,m="99",t=o.area&&/^\d+(,\d+){3}$/.test(o.area)?o.area?.split(",").map(d=>parseInt(d,10)):void 0,c=o.src||"/img/mindon.png",i=o.rgb||"",e=r?.getContext("2d");e?.clearRect(0,0,r.width,r.height);let f,[l,b,p]=[0,0,0];if(!e)return;e.imageSmoothingEnabled=!0;let y=new Image;y.crossOrigin="anonymous",y.addEventListener("load",R);let x,C=document.createElement("canvas");c&&(y.src=c);function R(){let[d,g]=[y.width,y.height];if(!t&&(d>960||g>960)){let M=Math.max(d/562,g/562);t=[0,0,d/M,g/M]}t&&([d,g]=t.slice(2)),[l,b,p]=[d/2,g/2,Math.sqrt((d/2)**2+(g/2)**2)],x={ctx:e,cx:l,cy:b,feature:n},r.width=d*(n.zoom||1),r.height=g*(n.zoom||1);let[D,F]=[Math.round(d/s),Math.round(g/s)];C.width=D,C.height=F;let v=C.getContext("2d"),[z,u]=[0,0];t&&([z,u]=t.slice(0,2)),v?.drawImage(y,z,u,t?d:y.width,t?g:y.height,0,0,D,F),A&&(y.width=d,y.height=g,r.parentElement?.appendChild(y));let w=v?.getImageData(0,0,D,F).data,$=[],L=[],O=[],H=[],j=[],B=[];for(let M=0;M<F;M++){let I=[];for(let k=0;k<D;k++)I.push([k,M]);B.push(I)}j=N(B),j.forEach(([M,I])=>{let[k,P,E]=[M*s,I*s,4*(I*D+M)],T=(w?.[E+3]||0)/255,W={x:k,y:P,v:(255-(w?.[E]||0))*T},_={x:k,y:P,v:(255-(w?.[E+1]||0))*T},J={x:k,y:P,v:(255-(w?.[E+2]||0))*T};H.push({x:k,y:P,v:(255-((w?.[E]||0)*.299+(w?.[E+1]||0)*.587+(w?.[E+2]||0)*.114))*T}),$.push(W),L.push(_),O.push(J)}),f={red:$,green:L,blue:O,lightness:H},q()}function q(){if(!e||!x)return;e.clearRect(0,0,r.width,r.height);let{red:d,green:g,blue:D,lightness:F}=f,v=Math.floor(p/s),z=10;if(e.lineWidth=n.stroke||1,/[rR*]/.test(i)){e.beginPath(),e.strokeStyle=`#ff0000${m}`;for(let u=0;u<v;u++)S(x,z+u*s,h,d);e.stroke()}if(/[gG*]/.test(i)){e.beginPath(),e.strokeStyle=`#008800${m}`;for(let u=0;u<v;u++)S(x,z+u*s,h,g);e.stroke()}if(/[bB*]/.test(i)){e.beginPath(),e.strokeStyle=`#0000ff${m}`;for(let u=0;u<v;u++)S(x,z+u*s,h,D);e.stroke()}if(!i||/[#*]/.test(i)){e.beginPath(),e.strokeStyle="#000000";for(let u=0;u<v;u++)S(x,z+u*s,h,F);e.stroke()}}}function S(r,a,o,A){let n=o*Math.PI/180,{ctx:h,cx:s,cy:m,feature:t}=r,c=Array.from(Array(Math.ceil(360/o)).keys()).map(l=>{let b={x:s+a*Math.cos(n*l),y:m-a*Math.sin(n*l)},p={x:b.x,y:b.y};return A?.forEach(y=>{let x=K(y,y.v||0,p,t);p.x+=x.x,p.y+=x.y}),p}),{zoom:i=1,tension:e=.25}=t,f=c.map(l=>[i*l.x,i*l.y]);h&&Q(h,f,e)}function K(r,a,o,A){let{x:n,y:h}=r,s=o.x,m=o.y,{g:t=1,k:c=1,z:i=2}=A,e=Math.sqrt((n-s)**2+(h-m)**2),f=t*a/e**i,l=n===s?h>m?Math.PI/2:-Math.PI/2:Math.atan((h-m)/(n-s));h===m?l=n<s?Math.PI:0:n<s&&(l-=Math.PI);let b={x:f*Math.cos(l)/c,y:f*Math.sin(l)/c};return Math.abs(b.x)>Math.abs(r.x-o.x)&&(b.x=r.x-o.x),Math.abs(b.y)>Math.abs(r.y-o.y)&&(b.y=r.y-o.y),b}function N(r,a=!0){let[o,A]=[r.length,r[0].length],n=r.map(e=>e.map(f=>!1)),h=[],s=[0,1,0,-1],m=[1,0,-1,0],[t,c,i]=[0,0,0];for(let e=0;e<o*A;e++){h.push(r[t][c]),n[t][c]=!0;let[f,l]=[t+s[i],c+m[i]];0<=f&&f<o&&0<=l&&l<A&&!n[f][l]?[t,c]=[f,l]:(i=(i+1)%4,[t,c]=[t+s[i],c+m[i]])}return a?h.reverse():h}function Q(r,a,o,A=!0){o=o||.25;let n=a.length;if(n<2)return;if(r.beginPath(),n===2){r.moveTo(a[0][0],a[0][1]),r.lineTo(a[1][0],a[1][1]),r.stroke();return}let h=(t,c)=>Math.sqrt(t*t+c*c),s=[];a.forEach(function(){s.push({cp:[],cn:[]})});for(let t=0;t<n;t++){let c=a[t],i=a[t-1<0?n+t-1:t-1],e=a[t+1>n-1?(t+1)%n:t+1],f=e[0]-i[0],l=e[1]-i[1],b=h(f,l),p=f/b,y=l/b,x=h(c[0]-i[0],c[1]-i[1]),C=h(c[0]-e[0],c[1]-e[1]),R=c[0]-p*x*o,q=c[1]-y*x*o,d=c[0]+p*C*o,g=c[1]+y*C*o;s[t]={cp:[R,q],cn:[d,g]}}r.moveTo(a[0][0],a[0][1]);let m=A?n+1:n;for(let t=1;t<m;t++){let c=a[t%n],i=s[t%n],e=s[t-1];r.bezierCurveTo(e.cn[0],e.cn[1],i.cp[0],i.cp[1],c[0],c[1])}r.stroke()}export{G as fieldFx};
